# Three.js 沉浸式云霄飞车动画开发提示词

你是一位精通 Three.js 和 WebGL 的高级前端开发工程师。请编写一个**完整、独立且可直接运行的 `index.html` 文件**，实现一个基于物理感观的高级云霄飞车动画。

## 1. 项目综述
构建一个全屏 3D 场景，展示一个小球沿着一条复杂、平滑且结构多变的轨道（过山车）高速运动。项目需重点关注曲线的平滑度、视觉的真实感以及流畅的相机跟随体验。

## 2. 技术栈与环境
- **核心库**：Three.js（请通过 CDN 引入最新稳定版，例如 `https://unpkg.com/three@0.160.0/build/three.min.js`）。
- **控件库**：OrbitControls（通过 CDN 引入）。
- **文件结构**：所有代码（HTML 结构、CSS 样式、JavaScript 逻辑）必须合并在一个单一的 HTML 文件中。
- **运行环境**：无需本地服务器，双击 HTML 文件即可在现代浏览器中运行。

## 3. 详细开发需求

### 3.1 场景与渲染 (Scene Setup)
- **渲染器**：创建一个全屏 `WebGLRenderer`，必须开启 `antialias: true`（抗锯齿），开启 `shadowMap` 支持阴影。
- **场景**：
  - 背景色：设置为淡粉色（Hex: `#FFC0CB` 或类似柔和色调）。
  - 雾化效果：添加轻微的 `Fog`，使远处物体柔和虚化。
- **地面**：创建一个无限大的灰白色平面（`PlaneGeometry`），接收阴影，材质为 `MeshStandardMaterial`。
- **光照系统**：
  - `AmbientLight`：强度 0.5，提供基础照明。
  - `DirectionalLight`：作为主光源，模拟太阳光，位置设置在侧上方，需开启 `castShadow`，并调整 `shadow.mapSize` 为 2048x2048 以保证阴影清晰。

### 3.2 轨道生成系统 (Track Generation) - **核心难点**
轨道必须使用 `CatmullRomCurve3` 生成，并严格遵循以下参数以保证极致平滑：
- **曲线配置**：`new THREE.CatmullRomCurve3(points, true, 'chordal', 0.1)`。
  - 必须使用 `'chordal'` 类型以处理非均匀分布的点。
  - `tension` 设置为 0.1 以确保曲线圆润。

**轨道分段逻辑**：
请编写辅助函数生成一系列 3D 坐标点（Vector3），并将它们拼接成一条闭合路径。路径需包含以下特征段落（请确保段落间无缝连接）：
1.  **螺旋爬升 (Helix)**：紧密的螺旋上升结构。
2.  **急速俯冲 (Funnel/Drop)**：模拟漏斗形状，半径逐渐减小并向下俯冲。
3.  **波浪起伏 (Wave)**：沿 Y 轴的正弦波运动。
4.  **垂直回环 (Loop-the-Loop)**：完整的 360 度垂直圆环。
5.  **急转弯**：在 XZ 平面的大幅度曲线。

**平滑度算法要求**：
- **采样密度**：螺旋和圆环段每圈至少生成 60-80 个点；直线或缓坡段可适当减少。
- **过渡处理**：在不同形状的段落之间，必须插入 3-5 个过渡点（Lerp 插值），确保相邻段落的切线角度变化小于 30 度，避免出现折角。
- **Chaikin 平滑（可选但推荐）**：在生成最终 Geometry 之前，对所有路径点应用简单的细分平滑算法（Chaikin's Algorithm），迭代 1-2 次，以消除微小的棱角。

**轨道模型**：
- 使用 `TubeGeometry`。
- **tubularSegments**（路径分段）：**必须设置为 1000 以上**（如 1200），这是保证轨道视觉平滑的关键。
- **radius**（半径）：设为 0.8 - 1.0。
- **radialSegments**（截面分段）：设为 16，保证管道截面圆润。
- **材质**：使用 `MeshPhysicalMaterial`，颜色为半透明白色，设置 `transmission: 0.6`，`roughness: 0.2`，模拟亚克力或高光塑料质感。

### 3.3 支架系统 (Support Pillars)
为了增加真实感，需自动生成支撑轨道的柱子：
- **生成逻辑**：沿轨道路径每隔固定距离（如每 40 个单位或每 50 个分段）采样一个点。
- **几何体**：使用 `CylinderGeometry` 创建圆柱体。
- **高度计算**：从轨道底部延伸至地面（Y=0）。
  - 注意：柱子高度 = (轨道点 Y 坐标) - (轨道半径)。
- **过滤条件**：如果计算出的柱子高度小于 5 个单位，则不生成该柱子（避免在低处生成过于密集的短柱）。
- **外观**：深灰色金属材质，底部添加简单的基座模型。

### 3.4 玩家/小球 (The Rider)
- 创建一个 `SphereGeometry` 代表云霄飞车/乘客。
- 材质：鲜艳的颜色（如亮红色或电蓝色），高光材质，确保在浅色背景中清晰可见。
- 添加一个点光源 (`PointLight`) 绑定在小球上，照亮经过的轨道内部。

### 3.5 动画与交互 (Animation & Controls)

**运动逻辑**：
- 在 `requestAnimationFrame` 中更新。
- 计算归一化时间 `t` (0 到 1)，使小球沿 `curve.getPointAt(t)` 移动。
- 速度控制：模拟重力加速度效果（下坡快，上坡慢）为加分项；若太复杂，保持匀速但流畅的运动亦可。
- **朝向控制**：每一帧都必须计算小球在当前位置的切线向量，使用 `.lookAt()` 或四元数旋转，确保小球始终正面朝向轨道延伸方向。

**相机视角切换（UI交互）**：
在屏幕左上角添加一个半透明的控制面板（HTML/CSS），包含一个按钮 "切换视角 (Toggle Camera)"：
1.  **第三人称/概览视角 (Orbit Mode)**：
    - 使用 `OrbitControls`。
    - 允许用户自由缩放、旋转查看整个轨道结构。
2.  **第一人称/沉浸视角 (POV Mode)**：
    - 相机绑定在小球位置的后上方（偏移量如 `y+2, z-2`）。
    - 相机视线始终跟随小球前方的轨道切线方向。
    - **平滑跟随**：相机位置更新应使用 `Vector3.lerp` 实现轻微的滞后感，模拟真实摄像机的惯性。

## 4. 代码质量要求
- **模块化**：将轨道生成（Spiral, Loop, Wave）封装为独立的函数。
- **注释**：关键逻辑（特别是曲线生成和相机跟随部分）需添加中文注释。
- **响应式**：监听 `resize` 事件，确保窗口大小改变时画布自适应。
- **无报错**：确保代码逻辑严密，变量定义清晰，无未定义的引用。

---

**请根据以上所有要求，生成最终的 HTML 代码。**
