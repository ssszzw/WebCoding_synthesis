# Three.js 完整项目开发提示词：大象牙膏3D仿真实验

作为一个精通 Three.js、WebGL 和物理模拟的前端开发专家，请编写一个包含 HTML、CSS 和 JavaScript 的**单文件 (index.html)**，实现一个逼真的“大象牙膏”化学反应 3D 演示。

## 1. 整体架构与技术栈
*   **文件结构**：所有代码必须内嵌在单个 HTML 文件中。
*   **库引用**：通过 CDN 引入 `three.min.js` 和 `OrbitControls.js` (建议使用 r128 或更新版本)。
*   **渲染器设置**：开启 `antialias`（抗锯齿），启用 `shadowMap`（阴影贴图，类型建议为 `THREE.PCFSoftShadowMap`），设置 `outputEncoding` 为 `sRGBEncoding`，开启 `toneMapping` 以获得逼真的光照效果。

## 2. 场景与环境设置
*   **地面**：
    *   创建一个 `1000x1000` 的平面几何体 (`PlaneGeometry`)。
    *   材质为灰色 (`0x808080`)，光滑度适中 (`MeshStandardMaterial`)。
    *   **关键点**：地面必须接收阴影 (`receiveShadow = true`)。
*   **光照系统**：
    *   **环境光**：`AmbientLight`，颜色暖白，强度 0.6，防止阴影过黑。
    *   **主光源**：`DirectionalLight` 或 `SpotLight`，位于侧上方，强度较高，开启阴影投射 (`castShadow = true`)。调整 `shadow.mapSize` 为 `2048x2048` 以保证阴影清晰。

## 3. 核心模型构建：三角烧瓶与液体
请不要加载外部模型，使用 Three.js 原生几何体组合或 `LatheGeometry`（车削几何体）通过定义点集来生成。

*   **三角烧瓶 (Erlenmeyer Flask)**：
    *   **几何结构**：必须具备平底、圆锥形瓶身、圆柱形瓶颈和略微加厚的瓶口。可以使用 `LatheGeometry` 定义其剖面轮廓。
    *   **玻璃材质**：使用 `MeshPhysicalMaterial` 实现真实玻璃质感。参数严格设置为：
        ```javascript
        {
          color: 0xffffff,
          transparent: true,
          opacity: 0.3, // 略微降低不透明度以更好地观察内部
          roughness: 0.1, // 降低粗糙度以获得清晰反射
          metalness: 0.1,
          clearcoat: 1.0,
          clearcoatRoughness: 0.03,
          transmission: 0.95, // 关键：透射
          ior: 1.5, // 玻璃折射率
          side: THREE.DoubleSide
        }
        ```
    *   **阴影**：开启投射阴影 (`castShadow`)。

*   **反应液体**：
    *   **建模**：复制烧瓶内部的几何形状，但尺寸略微缩小以避免 Z-fighting（闪烁）。
    *   **初始状态**：高度约为烧瓶的 1/3。
    *   **材质**：荧光粉色 (`0xff007f` 或类似)，发光材质或高饱和度的 `MeshStandardMaterial`。
    *   **动画逻辑**：随着喷发开始，液体的几何体高度（Y轴缩放）需要逐渐降低至 0，且变换中心点（Pivot）必须在底部，表现出液面下降的效果。

## 4. 粒子系统：泡沫喷发模拟
这是本项目的核心，请勿使用简单的粒子发射器，需要编写自定义的物理逻辑更新循环。

*   **泡沫粒子外观**：
    *   使用低多边形的 `IcosahedronGeometry` (detail=0 或 1) 或 `SphereGeometry`。
    *   材质为荧光粉色，半透明，具有一定的光泽感。
    *   为了模拟“粗糙的多孔质感”，请生成一个程序化的噪点贴图（CanvasTexture）作为 bumpMap 或 displacementMap，或者通过顶点着色器添加轻微的顶点位移。

*   **喷射动力学 (Eruption Phase)**：
    *   **触发**：点击 UI 按钮后开始。
    *   **生成速率**：初始阶段每帧生成大量粒子，模拟猛烈反应；随时间推移，生成速率按指数衰减。
    *   **初始速度**：
        *   **Y轴**：给予极高的向上初速度，足以形成 3 倍于烧瓶高度的泡沫柱。
        *   **X/Z轴**：给予微小的随机扩散速度，使泡沫在上升初期保持紧密的圆柱形态（Columnar flow）。
    *   **扰动**：在达到最高点附近时，增加水平方向的随机速度，模拟泡沫柱顶部的崩塌和扩散。

*   **物理模拟与交互 (Physics Phase)**：
    *   **重力**：所有粒子每帧受到重力加速度 (g) 的影响向下坠落。
    *   **碰撞检测**：检测粒子 y 坐标。
    *   **落地变形 (Squash & Stretch)**：
        *   当粒子接触地面 (y <= 0) 或烧瓶外壁区域时，停止其位置移动。
        *   **关键视觉效果**：修改粒子的缩放 (Scale)。将 Y 轴压缩 (如 0.4)，X 和 Z 轴拉伸 (如 1.5)，模拟泡沫球落地被压扁的效果。
    *   **堆积与融合**：落地后的粒子不要立即销毁。让它们在地面停留，并允许后续落下的粒子在已有粒子之上堆积（可以通过简单的 Y 轴偏移累加或距离判断实现），形成厚厚的泡沫层。
    *   **滑动摩擦**：落地后保留极短时间的水平滑动惯性，然后完全静止 (`velocity = 0`)。

## 5. 交互与 UI
*   **UI 布局**：在页面底部居中位置创建一个样式现代的按钮。
*   **样式**：深色背景，圆角，白色文字 "Start Reaction"，悬停效果。
*   **功能**：点击按钮触发 `startEruption()` 函数，重置场景（如果需要）并开始动画循环。

## 6. 摄像机控制
*   配置 `PerspectiveCamera`。
*   位置：设置在 `(x: 20, y: 30, z: 40)` 或类似位置，从斜上方 45 度俯视烧瓶。
*   控制：使用 `OrbitControls` 允许用户自由旋转和缩放观察细节，焦点 (`target`) 设为烧瓶中心。

## 7. 动画循环 (Animation Loop)
*   使用 `requestAnimationFrame`。
*   每帧更新：
    1.  更新控制器 (`controls.update()`)。
    2.  如果反应已开始：
        *   减少烧瓶内液体的高度。
        *   生成新泡沫粒子（根据当前产生速率）。
        *   遍历所有活性粒子，更新位置、速度、重力影响和碰撞状态。
    3.  渲染场景 (`renderer.render()`)。

## 代码生成要求
请直接生成最终的 HTML 文件内容。确保代码逻辑清晰，包含必要的注释。特别注意 **玻璃材质的物理参数** 和 **泡沫粒子落地变形** 的算法实现。
