# 前端游戏开发提示词：基于LocalStorage的本地多窗口对战射击游戏

请编写一个单文件 HTML 游戏（包含 HTML, CSS, JavaScript），创建一个名为 "Local Duel Shooter" 的 2D 俯视视角射击游戏。该游戏旨在模拟截图中的效果，允许用户打开两个浏览器标签页或窗口，在同一台电脑上进行实时对战。

### 1. 整体架构与技术实现
*   **文件结构**：所有代码必须整合在一个 `index.html` 文件中。
*   **核心渲染**：使用 HTML5 `<canvas>` 进行高性能图形渲染。
*   **通信机制（关键）**：由于没有后端服务器，**必须使用 `window.localStorage` 和 `window.addEventListener('storage', ...)` 事件**来实现两个浏览器窗口之间的实时状态同步。
    *   当窗口 A 中的玩家移动或射击时，将状态写入 LocalStorage。
    *   窗口 B 监听到 Storage 变化，更新“敌人”的位置和状态。
    *   实现简单的“房间”逻辑：第一个打开窗口的为“主机/玩家1（红色）”，第二个打开的为“客机/玩家2（黄色）”。
*   **自适应布局**：Canvas 需自动充满整个浏览器窗口，窗口大小调整时自适应。

### 2. 视觉效果与UI设计
参考提供的截图，请精确还原以下视觉风格：
*   **背景**：深绿色（类似 `#387038`）填充整个屏幕，叠加浅色细线网格（Grid），模拟战术地图或草地质感。
*   **角色设计**：
    *   **形状**：简单的圆形，带有黑色描边。
    *   **颜色**：玩家 1 为红色（`#e74c3c`），玩家 2 为黄色（`#f1c40f`）。
    *   **方向指示**：在圆心到圆边缘绘制一条黑色粗线（模拟枪管），该线条应跟随鼠标光标位置旋转。
*   **UI 元素**：
    *   **血条（头顶）**：在每个角色头顶上方悬浮一个小型血条。绿色代表当前血量，灰色/红色代表已损失血量。
    *   **全局生命值文本**：在屏幕左上角显示大号白色文字，例如 "Health: 100"。
    *   **操作指南面板**：在屏幕左下角放置一个半透明黑色圆角矩形，包含白色文字说明：
        *   `W A S D` - Move (移动)
        *   `Mouse` - Aim (瞄准)
        *   `Click` - Shoot (射击)
    *   **子弹**：纯白色小圆点，高对比度。

### 3. 交互与游戏逻辑
*   **控制系统**：
    *   **移动**：使用 WASD 键控制角色在地图上的 X/Y 轴移动，具有平滑的加速度和摩擦力感。
    *   **瞄准**：角色始终面朝鼠标光标位置。
    *   **射击**：点击鼠标左键发射子弹。子弹应沿当前瞄准方向直线飞行。设置合理的射击冷却时间（如 200ms）。
*   **碰撞检测**：
    *   子弹击中敌方角色圆形碰撞体时，判定为命中。
    *   命中后扣除生命值（如每发子弹扣 10 点）。
    *   子弹击中后或飞出屏幕后消失。
*   **游戏流程**：
    *   初始生命值为 100。
    *   当一方生命值归零时，判定该玩家失败，并重置双方位置和血量，开始新一轮。
    *   需要在两个窗口中同步显示子弹的轨迹和命中效果。

### 4. 代码实现细节要求
*   **CSS**：使用绝对定位将 UI 覆盖在 Canvas 之上。字体使用无衬线字体（sans-serif），加粗以提高清晰度。
*   **JS 类结构**：建议创建 `Game`, `Player`, `Bullet` 类来管理逻辑。
*   **同步逻辑优化**：
    *   为了流畅度，本地玩家位置直接渲染，远程玩家位置通过 `requestAnimationFrame` 插值平滑过渡（避免卡顿）。
    *   数据包应包含：`playerId`, `x`, `y`, `angle`, `isShooting`, `health`, `timestamp`。
*   **防抖与清理**：确保关闭窗口时触发 `window.onbeforeunload` 清理 LocalStorage 中的玩家状态，避免“幽灵玩家”残留。

### 5. 输出
请直接输出包含所有逻辑的完整 HTML 代码，不要在此之外添加解释性文字，确保代码复制保存为 `.html` 文件后，直接双击打开两个窗口即可开始对战。
