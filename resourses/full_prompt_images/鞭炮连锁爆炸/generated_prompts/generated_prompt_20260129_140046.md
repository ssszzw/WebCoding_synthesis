# Role: 高级前端 WebGL 开发工程师 (Three.js 专家)

请编写一个单文件 HTML 项目，利用 Three.js 库实现一个逼真的 **"鞭炮箱子 3D 爆炸连锁反应"** 模拟演示。

## 1. 项目概述
创建一个基于物理模拟的交互式场景：一个装满鞭炮的透明玻璃箱子，当外部火源（一个燃烧的鞭炮）落入箱中后，引发真实的爆炸连锁反应。场景需包含物理碰撞、引线燃烧、粒子爆炸、烟雾、光照变化以及纸屑飞溅效果。

## 2. 技术栈与环境约束
- **核心库：** Three.js (请通过 CDN 引入最新稳定版: `https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js`)。
- **文件结构：** 所有的 HTML、CSS 和 JavaScript 必须封装在一个唯一的 `index.html` 文件中。
- **依赖限制：** 不得使用其他外部物理引擎（如 Cannon.js），需编写自定义的轻量级物理/碰撞逻辑以确保代码简洁和可控。

## 3. 详细开发规范

### 3.1 场景与环境 (Scene Setup)
- **渲染器：** 开启抗锯齿 (`antialias: true`)，开启阴影贴图 (`shadowMap.enabled = true`, 类型为 `PCFSoftShadowMap`)。
- **摄像机：** 透视投影，位置设为 `(0, 15, 15)`，看向原点 `(0, 0, 0)`（斜 45 度俯视），需实现轨道控制器（可用鼠标旋转缩放）。
- **地面：**
  - 几何体：1000x1000 平面。
  - 材质：灰色 `0x808080`，粗糙度 `0.8`，金属度 `0.1`。
  - 属性：接收阴影 (`receiveShadow = true`)。
- **光照系统：**
  - **环境光：** 强度 `0.4`，颜色 `0xffffff`。
  - **主光源：** 平行光 (`DirectionalLight`)，位置 `(50, 100, 50)`，强度 `1.2`，开启阴影投射 (`castShadow = true`)，阴影分辨率 `2048x2048`。
  - **动态光：** 爆炸时需在爆炸点生成临时的点光源 (`PointLight`)，颜色从橙红渐变至白色，并在短时间内衰减消失。

### 3.2 3D 建模规范 (Modeling)

#### A. 鞭炮模型 (Firecracker Class)
每个鞭炮应为一个 `Group` 对象，包含以下部分：
1.  **主体：** 红色圆柱体 (`Color: 0xff0000`, `Roughness: 0.6`, `Metalness: 0.2`)，高 1，直径 0.2。
2.  **封土：** 上下各一个土黄色圆柱 (`Color: 0xdaa520`)，高 0.05。
3.  **引线：** 顶部中心伸出的蓝绿色细线 (`Color: 0x20b2aa`)，长 0.5，直径 0.05。
4.  **火星：** 引线顶端需附带一个小发光球体（仅在燃烧状态显示），颜色橙红。
5.  **碰撞体：** 为每个鞭炮定义简单的圆柱或球体碰撞边界，用于计算堆叠和爆炸弹射。

#### B. 透明箱子 (Container)
1.  **尺寸：** 10x10x8 (长x宽x高)。
2.  **材质：** 透明玻璃质感 (`Color: 0xffffff`, `Opacity: 0.15`, `Roughness: 0.1`, `Transparent: true`)，开启双面渲染 (`side: THREE.DoubleSide`)。
3.  **物理属性：**
    - 四周侧壁和底部具有碰撞体积（阻止鞭炮穿出）。
    - **顶部完全开放**（允许鞭炮落入）。
4.  **位置：** 放置于平面中心偏后方。

### 3.3 动画与物理模拟逻辑 (Animation & Physics)

#### A. 生成与堆叠
- 场景初始化时，执行“装箱”动画。
- 分 10 组生成鞭炮，每组 10 个（共 100 个）。
- 生成位置：箱子正上方 Y=5 至 Y=15 的区域内随机分布。
- 物理行为：鞭炮受重力影响自由落体，与箱壁、地面及其他鞭炮发生简单的体积碰撞及堆叠（模拟真实散落）。

#### B. 触发机制
- UI 提供“开始燃放”按钮。
- 点击后，生成一个**已点燃**的鞭炮（引线在燃烧，有火花），从屏幕上方以抛物线轨迹精准落入箱子中央。

#### C. 燃烧与爆炸流程
1.  **引线燃烧：**
    - 持续时间：2 秒。
    - 视觉：引线几何体沿 Y 轴逐渐缩短，顶端火星跟随移动并伴有微弱闪烁光。
2.  **爆炸瞬间：**
    - **模型销毁：** 鞭炮模型立即从场景移除。
    - **视觉特效：**
        - **闪光：** 屏幕瞬间轻微泛白（Post-processing 或覆盖层模拟），并在位置处生成强点光源。
        - **纸屑：** 生成 50-80 个红色/粉色小方形碎片，向四周炸开。
        - **烟雾：** 生成灰白色半透明球体，向上飘动并透明度渐变至 0。
        - **冲击波：** 一个快速扩大的透明球体，模拟空气扭曲。
3.  **物理冲击：**
    - 计算爆炸点半径 3 单位内的其他鞭炮。
    - 施加向外的斥力向量，使周围鞭炮产生位移、弹跳和随机旋转（翻滚）。
    - 碎片需受重力影响落回地面并残留。

#### D. 连锁反应 (Chain Reaction Manager)
- **判定：** 每次爆炸产生一个半径 3 的“热区”。
- **传播：** 热区内的未爆炸鞭炮将被“引燃”。
- **随机性：** 被引燃的鞭炮不会立即爆炸，而是先点燃引线（缩短至 1 秒倒计时），且每个鞭炮增加 0.1-0.3 秒的随机延迟，确保爆炸节奏有层次感，形成多米诺效应。

### 3.4 代码结构设计 (Architecture)

请严格遵循以下类结构进行编码：

1.  `class Firecracker`:
    - 属性：`mesh` (Group), `state` (IDLE, BURNING, EXPLODED), `velocity` (Vector3), `fuseLength`.
    - 方法：`ignite()`, `update(deltaTime)`, `explode()`.
2.  `class ParticleSystem`:
    - 管理所有的纸屑、烟雾粒子。
    - 使用 `InstancedMesh` 或简单的几何体数组来优化性能。
    - 方法：`createExplosion(position)`, `update()`.
3.  `class PhysicsEngine`:
    - 处理简单的重力、地面反弹、箱壁限制。
    - 处理鞭炮之间的排斥力（简化版 Sphere-Sphere 碰撞）。
4.  `class SimulationManager`:
    - 统筹整个流程，管理鞭炮数组，处理用户交互。
    - 包含 `triggerInitialFirecracker()` 方法。

### 3.5 用户交互界面 (UI)
在 HTML 中创建一个绝对定位的 UI 层：
1.  **左上角：** 标题 "Three.js Firecracker Chain Reaction"。
2.  **右上角：** 统计面板。
    - "剩余鞭炮: XX"
    - "已爆炸: XX"
3.  **底部居中：** 控制栏。
    - 按钮 [开始燃放]：触发初始引信。
    - 按钮 [重置场景]：清空所有碎片，重新生成鞭炮堆叠。
    - 按钮 [测试单发]：随机引爆箱内某一个鞭炮（用于调试）。

## 4. 视觉增强细节
- **动态阴影：** 确保运动中的鞭炮和碎片阴影实时更新。
- **颜色变化：** 引线燃烧时，周围材质可轻微受到橙色光照影响。
- **屏幕震动：** 在发生大规模连续爆炸时，轻微抖动摄像机位置 (`camera.position`) 模拟冲击感。

## 5. 输出要求
请直接输出完整的 Markdown 代码块，包含 `<!DOCTYPE html>`，内嵌 CSS 样式和 JavaScript 逻辑。代码需经过逻辑检查，确保无语法错误，复制后即可直接运行。**不需要任何额外的解释性文字，只输出代码。**
