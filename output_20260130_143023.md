```markdown
# Role: Three.js 高级图形工程师 / 物理仿真专家

## Project: 3D鞭炮连锁爆炸仿真系统 (Firecracker Chain Reaction Simulation)

## 1. 项目概述
基于 **Three.js** 开发一个高性能的3D鞭炮燃放仿真场景。核心目标是模拟中国传统鞭炮（大地红/百子炮）的点燃、多米诺式连锁爆炸、以及爆炸后的物理反馈。系统需包含自定义的轻量级物理引擎来处理冲击波与碎片碰撞，并实现逼真的视觉特效（烟雾、火光、纸屑堆积）。

## 2. 核心功能需求

### 2.1 场景与模型构建 (Scene & Modeling)
*   **鞭炮模型生成**：
    *   使用 `InstancedMesh` 渲染数千个单体鞭炮以优化性能。
    *   单体结构：红色圆柱体（炮身）+ 顶部金色装饰 + 编织在一起的引线结构。
    *   **布局算法**：程序化生成一条蜿蜒或悬挂的鞭炮串（基于 Catmull-Rom 样条曲线或物理悬挂曲线），确保鞭炮密集排列。
*   **环境**：包含一个具有物理属性的地面（用于接收碎屑堆积）。

### 2.2 引线燃烧系统 (Fuse Burning System)
*   **动态纹理/Shader**：编写自定义 ShaderMaterial，通过 Uniform 控制引线上的“燃烧点”推进。
*   **火花粒子**：在燃烧点位置实时发射高亮的火花粒子（Sparks），带有随机弹跳和淡出效果。
*   **多米诺逻辑**：
    *   当燃烧点接触到单体鞭炮的连接处时，触发该鞭炮的“引爆倒计时”。
    *   实现**连锁判定**：爆炸不仅由引线触发，邻近的猛烈爆炸也应有概率殉爆未点燃的鞭炮。

### 2.3 自定义物理与冲击波 (Custom Physics & Shockwave)
*   **爆炸冲击波 (Shockwave Force)**：
    *   不依赖重型物理引擎（如Ammo.js），需手写轻量级物理计算。
    *   当鞭炮爆炸时，产生一个球形膨胀的力场。
    *   **对环境的影响**：周围尚未爆炸的鞭炮受冲击波影响需产生物理摆动（基于弹簧阻尼模型或Verlet积分）。
*   **碎片散射**：爆炸瞬间，将单体鞭炮Mesh隐藏，并在该位置生成数十个“纸屑碎片”粒子，赋予其初始径向爆炸速度。

### 2.4 粒子特效与堆积系统 (VFX & Accumulation)
*   **碎屑堆积 (Realistic Debris)**：
    *   **碎片物理**：碎片受重力、空气阻力影响下落。
    *   **地面碰撞**：检测碎片与 $y=0$ 地面的碰撞。落地后不立即消失，而是根据地面法线停止运动，形成**永久性堆积层**（可通过合并几何体或更新Instance矩阵优化性能），模拟“满地红”的效果。
*   **体积烟雾 (Volumetric Smoke)**：
    *   爆炸点生成各向异性的烟雾粒子贴图。
    *   烟雾需具备颜色渐变（从爆炸中心的白热/黄色过渡到深灰）。
    *   受风力场和热浮力影响向上漂浮并扩散。

### 2.5 动态光照与后期 (Dynamic Lighting & Post-processing)
*   **反应式光照**：
    *   避免为每个爆炸创建 PointLight（性能消耗过大）。
    *   实现一个光照管理池，仅在当前最亮的爆炸点激活动态光源，或使用屏幕空间发光（Bloom）模拟瞬间高亮。
*   **相机反馈**：爆炸瞬间给相机施加微小的随机震动（Camera Shake）。

## 3. 技术栈与实现细节

*   **核心库**：Three.js (r150+).
*   **着色器**：GLSL (用于自定义粒子行为和引线燃烧效果).
*   **性能优化**：
    *   使用 `InstancedBufferGeometry` 处理粒子系统。
    *   对象池（Object Pooling）技术复用爆炸粒子，避免频繁GC。
    *   逻辑帧与渲染帧分离（物理计算可适当降频）。

## 4. 输出要求

请提供包含以下内容的完整代码结构或实现步骤：
1.  **类结构设计**：如 `FirecrackerSystem`, `PhysicsWorld`, `ParticleManager`。
2.  **关键算法片段**：
    *   冲击波对邻近物体的受力计算公式。
    *   碎屑落地并堆积的逻辑实现。
3.  **Shader思路**：引线燃烧进度的片元着色器逻辑。

---
**注意**：最终效果应追求影视级的混乱感与物理真实感，重点在于“连绵不绝的爆炸节奏”和“逐渐覆盖地面的红色纸屑”。
```